<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Monitoring PZEM</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
  <h2>Realtime Monitoring PZEM</h2>
  <table border="1" cellpadding="10" id="dataTable">
    <thead>
      <tr>
        <th>Tanggal</th>
        <th>Jam</th>
        <th>Tegangan (V)</th>
        <th>Arus (A)</th>
        <th>Daya (W)</th>
        <th>Frekuensi (Hz)</th>
      </tr>
    </thead>
    <tbody id="tableBody">
      <!-- Data akan muncul di sini -->
    </tbody>
  </table>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDeYF2Sp3-_1TIMIqpbnGSD9WruZcXwZ8E",
      authDomain: "gkm-sundec.firebaseapp.com",
      databaseURL: "https://gkm-sundec-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "gkm-sundec",
      storageBucket: "gkm-sundec.appspot.com",
      messagingSenderId: "336581347048",
      appId: "1:336581347048:web:1fa0a2fc376aa30d2eab5d",
      measurementId: "G-3MZCY9NTD9"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const tableBody = document.getElementById("tableBody");

    database.ref('Log').on('value', (snapshot) => {
      tableBody.innerHTML = ''; // Kosongkan tabel sebelum update
      const data = snapshot.val();
      if (data) {
        Object.keys(data).forEach(tanggal => {
          const jamData = data[tanggal];
          Object.keys(jamData).forEach(jam => {
            const item = jamData[jam];
            const row = `
              <tr>
                <td>${tanggal}</td>
                <td>${jam}</td>
                <td>${item['1_Voltage'] || '-'}</td>
                <td>${item['2_Current'] || '-'}</td>
                <td>${item['3_Power'] || '-'}</td>
                <td>${item['4_Frequency'] || '-'}</td>
              </tr>
            `;
            tableBody.innerHTML += row;
          });
        });
      }
    });
  </script>
</body>
</html>
